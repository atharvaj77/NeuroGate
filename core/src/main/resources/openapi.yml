openapi: 3.0.3
info:
  title: NeuroGate API
  description: |
    Enterprise AI Gateway API providing intelligent LLM routing, PII protection,
    semantic caching, and multi-provider orchestration.

    ## Features
    - **Multi-Provider Routing**: Intelligent routing across OpenAI, Anthropic, Google, AWS Bedrock, and Azure
    - **PII Protection**: Automatic detection and redaction of sensitive data (NeuroGuard)
    - **Semantic Caching**: 4-tier caching with semantic similarity matching
    - **Cost Tracking**: Real-time usage and cost analytics
    - **Agent Operations**: Trace and monitor AI agent workflows

    ## Authentication
    NeuroGate supports two authentication modes:

    1) JWT via Clerk (for UI and user sessions)
    ```
    Authorization: Bearer <clerk-jwt>
    ```

    2) API key (for programmatic access)
    ```
    Authorization: Bearer ng_live_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
    ```
    or
    ```
    X-API-Key: ng_live_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
    ```

  version: 1.0.0
  contact:
    name: NeuroGate Team
    url: https://neurogate.dev
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0

servers:
  - url: http://localhost:8080
    description: Local Development
  - url: https://api.neurogate.dev
    description: Production

tags:
  - name: Chat
    description: OpenAI-compatible chat completions API
  - name: Models
    description: Model information and pricing
  - name: Analytics
    description: Usage analytics and cost tracking
  - name: NeuroGuard
    description: PII detection and protection
  - name: RAG
    description: Retrieval-Augmented Generation (Nexus)
  - name: Cortex
    description: Response evaluation engine
  - name: Forge
    description: Model fine-tuning and distillation
  - name: Reinforce
    description: Human-in-the-loop feedback
  - name: Synapse
    description: Prompt optimization
  - name: Consensus
    description: Multi-model consensus (Hive Mind)
  - name: AgentOps
    description: Agent trace and monitoring
  - name: Memory
    description: Agent memory management
  - name: Flywheel
    description: Continuous improvement pipeline
  - name: Debugger
    description: Session replay and debugging
  - name: Prompts
    description: Prompt management and versioning

paths:
  # ==================== Chat API ====================
  /v1/chat/completions:
    post:
      tags: [Chat]
      summary: Create chat completion
      description: Send a chat completion request. Supports streaming via SSE when stream=true.
      operationId: createChatCompletion
      parameters:
        - name: X-Canary-Weight
          in: header
          description: Canary weight for A/B testing (0-100)
          schema:
            type: integer
        - name: X-Trace-Id
          in: header
          description: Trace ID for distributed tracing
          schema:
            type: string
        - name: X-Session-Id
          in: header
          description: Session ID for conversation tracking
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequest'
      responses:
        '200':
          description: Successful completion
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'
            text/event-stream:
              schema:
                type: string
        '400':
          description: Invalid request
        '429':
          description: Rate limit exceeded
        '500':
          description: Internal server error

  # ==================== Models API ====================
  /v1/models:
    get:
      tags: [Models]
      summary: List all models
      description: Get all available models with their information
      operationId: listModels
      parameters:
        - name: provider
          in: query
          description: Filter by provider
          schema:
            type: string
      responses:
        '200':
          description: Models retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelList'

  /v1/models/{modelId}:
    get:
      tags: [Models]
      summary: Get model details
      description: Get detailed information about a specific model
      operationId: getModel
      parameters:
        - name: modelId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Model found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelInfo'
        '404':
          description: Model not found

  /v1/models/{modelId}/pricing:
    get:
      tags: [Models]
      summary: Get model pricing
      description: Get pricing information for a specific model
      operationId: getModelPricing
      parameters:
        - name: modelId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Pricing retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelPricing'

  /v1/models/estimate:
    post:
      tags: [Models]
      summary: Estimate request cost
      description: Estimate the cost for a request based on input/output tokens
      operationId: estimateCost
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EstimateRequest'
      responses:
        '200':
          description: Estimate calculated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CostEstimate'

  /v1/models/compare:
    post:
      tags: [Models]
      summary: Compare model costs
      description: Compare costs across multiple models for the same request
      operationId: compareModels
      parameters:
        - name: models
          in: query
          description: Models to compare (comma-separated)
          schema:
            type: string
            default: gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022,gemini-1.5-pro
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EstimateRequest'
      responses:
        '200':
          description: Comparison generated
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CostEstimate'

  # ==================== Analytics API ====================
  /api/v1/analytics/costs/user/{userId}:
    get:
      tags: [Analytics]
      summary: Get user cost report
      operationId: getUserCosts
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
        - name: from
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: to
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Cost report retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CostReport'

  /api/v1/analytics/costs/team/{teamId}:
    get:
      tags: [Analytics]
      summary: Get team cost report
      operationId: getTeamCosts
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
        - name: from
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: to
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Team cost report retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TeamCostReport'

  # ==================== NeuroGuard API ====================
  /v1/neuroguard/analyze/prompt:
    post:
      tags: [NeuroGuard]
      summary: Analyze prompt for threats
      operationId: analyzePrompt
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnalyzeRequest'
      responses:
        '200':
          description: Analysis completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ThreatDetectionResult'

  /v1/neuroguard/analyze/output:
    post:
      tags: [NeuroGuard]
      summary: Analyze output for toxicity
      operationId: analyzeOutput
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnalyzeRequest'
      responses:
        '200':
          description: Analysis completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ThreatDetectionResult'

  /v1/neuroguard/scan:
    post:
      tags: [NeuroGuard]
      summary: Full security scan
      operationId: fullSecurityScan
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScanRequest'
      responses:
        '200':
          description: Scan completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecurityScanResult'

  /v1/neuroguard/stats:
    get:
      tags: [NeuroGuard]
      summary: Get security statistics
      operationId: getSecurityStats
      responses:
        '200':
          description: Statistics retrieved
          content:
            application/json:
              schema:
                type: object

  # ==================== RAG API ====================
  /api/rag/strategy:
    post:
      tags: [RAG]
      summary: Determine RAG strategy
      operationId: determineStrategy
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequest'
      responses:
        '200':
          description: Strategy determined
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RAGStrategy'

  /api/rag/search:
    post:
      tags: [RAG]
      summary: Search documents
      operationId: searchDocuments
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchRequest'
      responses:
        '200':
          description: Search results returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ScoredPoint'

  /api/rag/documents:
    post:
      tags: [RAG]
      summary: Add document
      operationId: addDocument
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddDocumentRequest'
      responses:
        '200':
          description: Document added
          content:
            application/json:
              schema:
                type: string

  # ==================== Cortex API ====================
  /api/v1/cortex/datasets:
    post:
      tags: [Cortex]
      summary: Create evaluation dataset
      operationId: createDataset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
      responses:
        '200':
          description: Dataset created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvaluationDataset'

  /api/v1/cortex/evaluate:
    post:
      tags: [Cortex]
      summary: Ad-hoc evaluation
      operationId: evaluateAdHoc
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdHocEvaluationRequest'
      responses:
        '200':
          description: Evaluation completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdHocEvaluationResponse'

  /api/v1/cortex/runs:
    post:
      tags: [Cortex]
      summary: Run evaluation
      operationId: runEvaluation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                datasetId:
                  type: string
                agentVersion:
                  type: string
      responses:
        '200':
          description: Evaluation completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvaluationRun'

  # ==================== Forge API ====================
  /api/v1/forge/jobs/trigger:
    post:
      tags: [Forge]
      summary: Trigger distillation job
      operationId: triggerDistillation
      responses:
        '200':
          description: Job triggered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DistillationJob'
        '204':
          description: No data available for distillation

  /api/v1/forge/jobs:
    get:
      tags: [Forge]
      summary: List distillation jobs
      operationId: listDistillationJobs
      responses:
        '200':
          description: Jobs retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DistillationJob'

  # ==================== Reinforce API ====================
  /api/v1/reinforce/queue:
    get:
      tags: [Reinforce]
      summary: Get annotation queue
      operationId: getAnnotationQueue
      responses:
        '200':
          description: Queue retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AnnotationTask'

  /api/v1/reinforce/{id}/review:
    post:
      tags: [Reinforce]
      summary: Review annotation task
      operationId: reviewAnnotationTask
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReviewRequest'
      responses:
        '200':
          description: Review submitted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnnotationTask'

  # ==================== Synapse API ====================
  /api/v1/synapse/prompts/{promptName}/workflow:
    get:
      tags: [Synapse]
      summary: Get prompt workflow
      operationId: getPromptWorkflow
      parameters:
        - name: promptName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Workflow retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PromptWorkflow'

  /api/v1/synapse/deploy:
    post:
      tags: [Synapse]
      summary: Deploy prompt
      operationId: deployPrompt
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeployRequest'
      responses:
        '200':
          description: Prompt deployed

  /api/v1/synapse/play:
    post:
      tags: [Synapse]
      summary: Playground execution
      operationId: playPrompt
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlayRequest'
      responses:
        '200':
          description: Execution completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'

  /api/v1/synapse/optimize:
    post:
      tags: [Synapse]
      summary: Optimize prompt
      operationId: optimizePrompt
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OptimizerRequest'
      responses:
        '200':
          description: Optimization completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OptimizerResponse'

  # ==================== Consensus API ====================
  /api/hive/consensus:
    post:
      tags: [Consensus]
      summary: Reach consensus
      operationId: reachConsensus
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequest'
      responses:
        '200':
          description: Consensus reached
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsensusResult'

  # ==================== AgentOps API ====================
  /v1/agentops/traces/{traceId}:
    get:
      tags: [AgentOps]
      summary: Get trace
      operationId: getTrace
      parameters:
        - name: traceId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Trace found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Trace'
        '404':
          description: Trace not found

  /v1/agentops/traces:
    get:
      tags: [AgentOps]
      summary: Get recent traces
      operationId: getRecentTraces
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: Traces retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Trace'

  /v1/agentops/sessions/{sessionId}/traces:
    get:
      tags: [AgentOps]
      summary: Get traces by session
      operationId: getTracesBySession
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Traces retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Trace'

  # ==================== Memory API ====================
  /v1/agent/memory:
    post:
      tags: [Memory]
      summary: Store memory
      operationId: storeMemory
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StoreMemoryRequest'
      responses:
        '200':
          description: Memory stored
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  memory_id:
                    type: string
    get:
      tags: [Memory]
      summary: Retrieve memory
      operationId: retrieveMemory
      parameters:
        - name: query
          in: query
          required: true
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            default: 5
      responses:
        '200':
          description: Memories retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string

  # ==================== Flywheel API ====================
  /v1/flywheel/feedback:
    post:
      tags: [Flywheel]
      summary: Submit feedback
      operationId: submitFeedback
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FeedbackRequest'
      responses:
        '200':
          description: Feedback recorded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GoldenInteraction'

  /v1/flywheel/golden:
    get:
      tags: [Flywheel]
      summary: Get golden interactions
      operationId: getGoldenInteractions
      responses:
        '200':
          description: Interactions retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GoldenInteraction'

  /v1/flywheel/export:
    get:
      tags: [Flywheel]
      summary: Export dataset
      operationId: exportDataset
      parameters:
        - name: model
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Dataset exported
          content:
            application/jsonl:
              schema:
                type: string

  # ==================== Debugger API ====================
  /api/debug/records:
    get:
      tags: [Debugger]
      summary: Search debug records
      operationId: searchDebugRecords
      parameters:
        - name: userId
          in: query
          schema:
            type: string
        - name: provider
          in: query
          schema:
            type: string
        - name: minCost
          in: query
          schema:
            type: number
        - name: maxLatency
          in: query
          schema:
            type: integer
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
      responses:
        '200':
          description: Records retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DebugRecord'

  /api/debug/sessions:
    post:
      tags: [Debugger]
      summary: Create debug session
      operationId: createDebugSession
      parameters:
        - name: requestId
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Session created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DebugSession'

  /api/debug/sessions/{sessionId}/replay:
    post:
      tags: [Debugger]
      summary: Replay request
      operationId: replayRequest
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReplayOptions'
      responses:
        '200':
          description: Replay completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'

  # ==================== Prompts API ====================
  /api/prompts/commit:
    post:
      tags: [Prompts]
      summary: Commit prompt
      operationId: commitPrompt
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommitRequest'
      responses:
        '200':
          description: Prompt committed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PromptVersion'

  /api/prompts/versions:
    get:
      tags: [Prompts]
      summary: Get version history
      operationId: getVersionHistory
      parameters:
        - name: branchName
          in: query
          schema:
            type: string
            default: main
      responses:
        '200':
          description: History retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PromptVersion'

  /api/prompts/templates:
    post:
      tags: [Prompts]
      summary: Create template
      operationId: createTemplate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TemplateRequest'
      responses:
        '200':
          description: Template created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PromptTemplate'
    get:
      tags: [Prompts]
      summary: Search templates
      operationId: searchTemplates
      parameters:
        - name: tag
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Templates found
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PromptTemplate'

components:
  schemas:
    # ==================== Core Schemas ====================
    ChatRequest:
      type: object
      required:
        - messages
      properties:
        model:
          type: string
          default: gpt-4o
        messages:
          type: array
          items:
            $ref: '#/components/schemas/Message'
        temperature:
          type: number
          default: 0.7
        max_tokens:
          type: integer
        stream:
          type: boolean
          default: false
        tools:
          type: array
          items:
            type: object
        tool_choice:
          type: string

    ChatResponse:
      type: object
      properties:
        id:
          type: string
        object:
          type: string
          default: chat.completion
        model:
          type: string
        choices:
          type: array
          items:
            $ref: '#/components/schemas/Choice'
        usage:
          $ref: '#/components/schemas/Usage'
        cache_hit:
          type: boolean
        route:
          type: string

    Message:
      type: object
      properties:
        role:
          type: string
          enum: [system, user, assistant, tool]
        content:
          type: string
        name:
          type: string
        tool_calls:
          type: array
          items:
            type: object

    Choice:
      type: object
      properties:
        index:
          type: integer
        message:
          $ref: '#/components/schemas/Message'
        finish_reason:
          type: string

    Usage:
      type: object
      properties:
        prompt_tokens:
          type: integer
        completion_tokens:
          type: integer
        total_tokens:
          type: integer

    # ==================== Models Schemas ====================
    ModelList:
      type: object
      properties:
        object:
          type: string
          default: list
        data:
          type: array
          items:
            $ref: '#/components/schemas/ModelInfo'

    ModelInfo:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        provider:
          type: string
        input_cost_per_1k:
          type: number
        output_cost_per_1k:
          type: number
        context_window:
          type: integer
        max_output_tokens:
          type: integer
        capabilities:
          type: array
          items:
            type: string
        available:
          type: boolean

    ModelPricing:
      type: object
      properties:
        model:
          type: string
        provider:
          type: string
        currency:
          type: string
        input_cost_per_1k_tokens:
          type: number
        output_cost_per_1k_tokens:
          type: number
        context_window:
          type: integer

    EstimateRequest:
      type: object
      required:
        - model
      properties:
        model:
          type: string
        input_text:
          type: string
        input_tokens:
          type: integer
        expected_output_tokens:
          type: integer

    CostEstimate:
      type: object
      properties:
        model:
          type: string
        estimated_input_tokens:
          type: integer
        estimated_output_tokens:
          type: integer
        input_cost:
          type: number
        output_cost:
          type: number
        total_cost:
          type: number
        cache_hit_cost:
          type: number
        potential_savings:
          type: number

    # ==================== Analytics Schemas ====================
    CostReport:
      type: object
      properties:
        user_id:
          type: string
        period:
          type: string
        total_cost:
          type: number
        total_requests:
          type: integer
        cache_hits:
          type: integer
        cache_hit_rate:
          type: number
        provider_breakdown:
          type: object
        model_breakdown:
          type: object

    TeamCostReport:
      type: object
      properties:
        team_id:
          type: string
        period:
          type: string
        total_cost:
          type: number
        user_breakdown:
          type: object

    # ==================== Security Schemas ====================
    AnalyzeRequest:
      type: object
      properties:
        content:
          type: string

    ScanRequest:
      type: object
      properties:
        prompt:
          type: string
        output:
          type: string

    ThreatDetectionResult:
      type: object
      properties:
        safe:
          type: boolean
        threats:
          type: array
          items:
            type: string
        score:
          type: number
        details:
          type: object

    SecurityScanResult:
      type: object
      properties:
        prompt_analysis:
          $ref: '#/components/schemas/ThreatDetectionResult'
        output_analysis:
          $ref: '#/components/schemas/ThreatDetectionResult'
        overall_safe:
          type: boolean

    # ==================== RAG Schemas ====================
    RAGStrategy:
      type: object
      properties:
        strategy:
          type: string
        reason:
          type: string
        collections:
          type: array
          items:
            type: string

    SearchRequest:
      type: object
      properties:
        query:
          type: string
        limit:
          type: integer
        collection:
          type: string

    ScoredPoint:
      type: object
      properties:
        id:
          type: string
        score:
          type: number
        payload:
          type: object

    AddDocumentRequest:
      type: object
      properties:
        title:
          type: string
        content:
          type: string
        source:
          type: string

    # ==================== Evaluation Schemas ====================
    EvaluationDataset:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        created_at:
          type: string
          format: date-time

    AdHocEvaluationRequest:
      type: object
      properties:
        test_cases:
          type: array
          items:
            type: object

    AdHocEvaluationResponse:
      type: object
      properties:
        results:
          type: array
          items:
            type: object
        summary:
          type: object

    EvaluationRun:
      type: object
      properties:
        id:
          type: string
        dataset_id:
          type: string
        agent_version:
          type: string
        status:
          type: string
        results:
          type: object

    # ==================== Forge Schemas ====================
    DistillationJob:
      type: object
      properties:
        id:
          type: string
          format: uuid
        status:
          type: string
        created_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time

    # ==================== Reinforce Schemas ====================
    AnnotationTask:
      type: object
      properties:
        id:
          type: integer
        status:
          type: string
        input:
          type: string
        output:
          type: string

    ReviewRequest:
      type: object
      properties:
        status:
          type: string
        correction:
          type: string
        reviewer:
          type: string

    # ==================== Synapse Schemas ====================
    PromptWorkflow:
      type: object
      properties:
        prompt_name:
          type: string
        production_version:
          type: string
        staging_version:
          type: string

    DeployRequest:
      type: object
      properties:
        prompt_name:
          type: string
        version_id:
          type: string
        environment:
          type: string
        user:
          type: string

    PlayRequest:
      type: object
      properties:
        prompt_content:
          type: string
        variables:
          type: object
        model:
          type: string

    OptimizerRequest:
      type: object
      properties:
        prompt:
          type: string
        goal:
          type: string

    OptimizerResponse:
      type: object
      properties:
        optimized_prompt:
          type: string
        improvements:
          type: array
          items:
            type: string

    # ==================== Consensus Schemas ====================
    ConsensusResult:
      type: object
      properties:
        consensus:
          type: string
        responses:
          type: array
          items:
            type: object
        confidence:
          type: number

    # ==================== Trace Schemas ====================
    Trace:
      type: object
      properties:
        trace_id:
          type: string
        session_id:
          type: string
        name:
          type: string
        start_time:
          type: string
          format: date-time
        end_time:
          type: string
          format: date-time
        duration_ms:
          type: integer
        status:
          type: string
        spans:
          type: array
          items:
            $ref: '#/components/schemas/Span'
        total_tokens:
          type: integer
        total_cost_usd:
          type: number

    Span:
      type: object
      properties:
        span_id:
          type: string
        trace_id:
          type: string
        parent_span_id:
          type: string
        name:
          type: string
        type:
          type: string
        start_time:
          type: string
          format: date-time
        end_time:
          type: string
          format: date-time
        duration_ms:
          type: integer
        status:
          type: string
        provider:
          type: string
        model:
          type: string
        input:
          type: string
        output:
          type: string
        token_count:
          type: integer
        cost_usd:
          type: number

    # ==================== Memory Schemas ====================
    StoreMemoryRequest:
      type: object
      properties:
        content:
          type: string
        metadata:
          type: object

    # ==================== Flywheel Schemas ====================
    FeedbackRequest:
      type: object
      properties:
        trace_id:
          type: string
        session_id:
          type: string
        rating:
          type: integer
        feedback_text:
          type: string
        feedback_type:
          type: string
        messages:
          type: array
          items:
            type: object
        response:
          type: string
        model:
          type: string
        corrected_output:
          type: string

    GoldenInteraction:
      type: object
      properties:
        id:
          type: string
        trace_id:
          type: string
        timestamp:
          type: string
          format: date-time
        rating:
          type: integer
        feedback_text:
          type: string

    # ==================== Debugger Schemas ====================
    DebugRecord:
      type: object
      properties:
        id:
          type: string
        user_id:
          type: string
        provider:
          type: string
        model:
          type: string
        cost:
          type: number
        latency_ms:
          type: integer
        timestamp:
          type: string
          format: date-time

    DebugSession:
      type: object
      properties:
        id:
          type: string
        request_id:
          type: string
        created_at:
          type: string
          format: date-time

    ReplayOptions:
      type: object
      properties:
        model:
          type: string
        temperature:
          type: number
        bypass_cache:
          type: boolean

    # ==================== Prompts Schemas ====================
    CommitRequest:
      type: object
      properties:
        prompt_text:
          type: string
        commit_message:
          type: string
        author:
          type: string
        branch_name:
          type: string

    PromptVersion:
      type: object
      properties:
        version_id:
          type: string
        prompt_text:
          type: string
        commit_message:
          type: string
        author:
          type: string
        created_at:
          type: string
          format: date-time

    TemplateRequest:
      type: object
      properties:
        template_name:
          type: string
        description:
          type: string
        template_text:
          type: string
        variables:
          type: object
        tags:
          type: array
          items:
            type: string

    PromptTemplate:
      type: object
      properties:
        id:
          type: string
        template_name:
          type: string
        description:
          type: string
        template_text:
          type: string
        variables:
          type: object
        tags:
          type: array
          items:
            type: string

  securitySchemes:
    clerkJwt:
      type: http
      scheme: bearer
      bearerFormat: JWT
    apiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key

security:
  - clerkJwt: []
  - apiKeyAuth: []

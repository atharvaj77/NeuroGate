# Staging Configuration Profile

server:
  port: 8080
  shutdown: graceful
  tomcat:
    threads:
      max: 200
      min-spare: 20
    max-connections: 10000

spring:
  application:
    name: neurogate

  jpa:
    hibernate:
      ddl-auto: update

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

  ai:
    openai:
      api-key: ${OPENAI_API_KEY}
      base-url: https://api.openai.com

  data:
    redis:
      host: ${REDIS_HOST:redis-service}
      port: ${REDIS_PORT:6379}
      timeout: 2000ms

neurogate:
  auth:
    enabled: ${NEUROGATE_AUTH_ENABLED:true}
    clerk:
      issuer: ${CLERK_ISSUER:}
      audience: ${CLERK_AUDIENCE:}
      jwks-uri: ${CLERK_JWKS_URI:}

  usage:
    plans:
      free-monthly-requests: ${NEUROGATE_PLAN_FREE_MONTHLY_REQUESTS:10000}
      pro-monthly-requests: ${NEUROGATE_PLAN_PRO_MONTHLY_REQUESTS:100000}
      team-monthly-requests: ${NEUROGATE_PLAN_TEAM_MONTHLY_REQUESTS:500000}

  qdrant:
    host: ${QDRANT_HOST:qdrant-service}
    grpc-port: 6334
    rest-port: 6333
    similarity-threshold: 0.92

  router:
    enable-semantic-cache: true
    cache-ttl-hours: 24

  rate-limit:
    enabled: true
    default-rpm: 1000
    burst-capacity: 100

resilience4j:
  circuitbreaker:
    configs:
      default:
        slidingWindowSize: 50
        minimumNumberOfCalls: 5
        waitDurationInOpenState: 30s
        failureRateThreshold: 50

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,circuitbreakers
  endpoint:
    health:
      show-details: always
      probes:
        enabled: true

logging:
  level:
    root: INFO
    com.neurogate: DEBUG
    org.springframework.ai: DEBUG
    io.github.resilience4j: DEBUG
